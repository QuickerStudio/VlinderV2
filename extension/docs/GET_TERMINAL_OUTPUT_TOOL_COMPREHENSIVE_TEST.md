# Get Terminal Output Tool - ç»¼åˆæµ‹è¯•æŠ¥å‘Š

## æµ‹è¯•æ¦‚è¿°

æœ¬æŠ¥å‘Šå¯¹ `get-terminal-output` å·¥å…·è¿›è¡Œå…¨é¢æµ‹è¯•ï¼ŒåŒ…æ‹¬åç«¯ä»£ç ã€å‰ç«¯UIã€çŠ¶æ€ç®¡ç†ã€é”™è¯¯å¤„ç†ç­‰å„ä¸ªæ–¹é¢ã€‚

## 1. åç«¯ä»£ç åˆ†æ

### 1.1 ä»£ç ç»“æ„åˆ†æ

**æ–‡ä»¶ä½ç½®**: `extension/src/agent/v1/tools/runners/get-terminal-output.tool.ts`

**æ ¸å¿ƒç±»**: `GetTerminalOutputTool extends BaseAgentTool<GetTerminalOutputToolParams>`

**ä¸»è¦æ–¹æ³•**:
- `execute()`: ä¸»æ‰§è¡Œæ–¹æ³•
- `getOutputFromTerminalId()`: é€šè¿‡IDè·å–ç»ˆç«¯è¾“å‡º
- `getOutputFromVscodeTerminal()`: ä»VS Codeç»ˆç«¯è·å–è¾“å‡º
- `buildXmlOutput()`: æ„å»ºXMLæ ¼å¼è¾“å‡º
- `escapeXml()`: XMLè½¬ä¹‰å¤„ç†

### 1.2 å‘ç°çš„é—®é¢˜

#### ğŸš¨ ä¸¥é‡é—®é¢˜1: è¾“å‡ºè·å–åŠŸèƒ½æœªå®ç°
```typescript
// ç¬¬101è¡Œ - è¾“å‡ºå§‹ç»ˆä¸ºç©ºå­—ç¬¦ä¸²
const output = ""
```

#### ğŸš¨ ä¸¥é‡é—®é¢˜2: ç»ˆç«¯è¾“å‡ºç¼“å†²åŒºæœªä½¿ç”¨
```typescript
// ç¬¬129-130è¡Œ - è¿”å›ç©ºå­—ç¬¦ä¸²è€Œä¸æ˜¯å®é™…è¾“å‡º
return ""
```

#### ğŸš¨ é—®é¢˜3: Shellç±»å‹ä¿¡æ¯ç¼ºå¤±
```typescript
// ç¬¬65è¡Œ - Shellç±»å‹æœªä»VS Code APIè·å–
shellType = undefined // Shell type not available from VS Code API
```

## 2. å‰ç«¯ä»£ç åˆ†æ

### 2.1 UIç»„ä»¶ç»“æ„

**æ–‡ä»¶ä½ç½®**: `extension/webview-ui-vite/src/components/chat-row/chat-tools.tsx`

**ç»„ä»¶**: `GetTerminalOutputBlock`

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… æ˜¾ç¤ºç»ˆç«¯IDã€åç§°ã€Shellç±»å‹
- âœ… æ˜¾ç¤ºæœ€å¤§å­—ç¬¦æ•°å’Œè¾“å‡ºé•¿åº¦
- âœ… é”™è¯¯ä¿¡æ¯æ˜¾ç¤º
- âœ… è¾“å‡ºå†…å®¹å±•ç¤º/éšè—åˆ‡æ¢
- âœ… å“åº”å¼è®¾è®¡

### 2.2 ç±»å‹å®šä¹‰

**æ–‡ä»¶ä½ç½®**: `extension/src/shared/new-tools.ts`

```typescript
export type GetTerminalOutputTool = {
	tool: "get_terminal_output"
	terminalId?: number
	maxChars?: number
	terminalName?: string
	shellType?: string
	outputLength?: number
	output?: string
	error?: string
}
```

## 3. å·¥å…·å‚æ•°Schemaåˆ†æ

**æ–‡ä»¶ä½ç½®**: `extension/src/agent/v1/tools/schema/get-terminal-output.ts`

**å‚æ•°**:
- `terminalId`: å¯é€‰ï¼Œç»ˆç«¯ID
- `maxChars`: å¯é€‰ï¼Œæœ€å¤§å­—ç¬¦æ•°ï¼ˆé»˜è®¤16000ï¼Œæœ€å¤§50000ï¼‰

**ç¤ºä¾‹ç”¨æ³•**:
```xml
<tool name="get_terminal_output">
  <terminalId>1</terminalId>
  <maxChars>5000</maxChars>
</tool>
```

## 4. ç»ˆç«¯ç®¡ç†å™¨é›†æˆåˆ†æ

### 4.1 TerminalRegistryåŠŸèƒ½

**æ–‡ä»¶ä½ç½®**: `extension/src/integrations/terminal/terminal-manager.ts`

**å…³é”®ç‰¹æ€§**:
- âœ… ç»ˆç«¯æ³¨å†Œå’Œç®¡ç†
- âœ… è¾“å‡ºç¼“å†²åŒº (`outputBuffers: Map<number, string>`)
- âœ… ç»ˆç«¯è¾“å‡ºæ˜ å°„ (`terminalOutputMap: Map<number, string[]>`)
- âŒ **é—®é¢˜**: get-terminal-outputå·¥å…·æœªä½¿ç”¨è¿™äº›ç¼“å†²åŒº

### 4.2 é›†æˆé—®é¢˜

1. **è¾“å‡ºç¼“å†²åŒºæœªè¿æ¥**: å·¥å…·æ²¡æœ‰ä» `TerminalRegistry.outputBuffers` è·å–æ•°æ®
2. **è¾“å‡ºæ˜ å°„æœªä½¿ç”¨**: `terminalOutputMap` ä¸­çš„æ•°æ®æœªè¢«åˆ©ç”¨
3. **å®æ—¶è¾“å‡ºæ•è·ç¼ºå¤±**: æ²¡æœ‰ç›‘å¬ç»ˆç«¯æ•°æ®å†™å…¥äº‹ä»¶

## 5. æµ‹è¯•ç”¨ä¾‹è®¾è®¡

### 5.1 åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯•ç”¨ä¾‹1: è·å–æ´»åŠ¨ç»ˆç«¯è¾“å‡º
```javascript
// è¾“å…¥å‚æ•°
{}

// æœŸæœ›è¡Œä¸º
- è·å–å½“å‰æ´»åŠ¨ç»ˆç«¯
- è¿”å›ç»ˆç«¯è¾“å‡ºå†…å®¹
- åŒ…å«ç»ˆç«¯åç§°å’Œè¾“å‡ºé•¿åº¦

// å½“å‰å®é™…ç»“æœ
- è¿”å›ç©ºè¾“å‡ºæˆ–é”™è¯¯ä¿¡æ¯
```

#### æµ‹è¯•ç”¨ä¾‹2: é€šè¿‡IDè·å–ç»ˆç«¯è¾“å‡º
```javascript
// è¾“å…¥å‚æ•°
{ terminalId: 1 }

// æœŸæœ›è¡Œä¸º
- æ‰¾åˆ°IDä¸º1çš„ç»ˆç«¯
- è¿”å›è¯¥ç»ˆç«¯çš„è¾“å‡ºå†…å®¹
- åŒ…å«ç»ˆç«¯ä¿¡æ¯

// å½“å‰å®é™…ç»“æœ
- è¿”å›ç©ºè¾“å‡º
```

#### æµ‹è¯•ç”¨ä¾‹3: é™åˆ¶è¾“å‡ºå­—ç¬¦æ•°
```javascript
// è¾“å…¥å‚æ•°
{ maxChars: 1000 }

// æœŸæœ›è¡Œä¸º
- è¿”å›æœ€å¤š1000ä¸ªå­—ç¬¦
- ä»è¾“å‡ºæœ«å°¾æˆªå–

// å½“å‰å®é™…ç»“æœ
- å­—ç¬¦é™åˆ¶é€»è¾‘æ­£ç¡®ï¼Œä½†è¾“å‡ºä¸ºç©º
```

### 5.2 é”™è¯¯å¤„ç†æµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯•ç”¨ä¾‹4: æ— æ•ˆç»ˆç«¯ID
```javascript
// è¾“å…¥å‚æ•°
{ terminalId: 999 }

// æœŸæœ›è¡Œä¸º
- è¿”å›é”™è¯¯ä¿¡æ¯
- XMLæ ¼å¼æ­£ç¡®

// å®é™…ç»“æœ
- âœ… æ­£ç¡®è¿”å›é”™è¯¯ä¿¡æ¯
```

#### æµ‹è¯•ç”¨ä¾‹5: æ— æ´»åŠ¨ç»ˆç«¯
```javascript
// è¾“å…¥å‚æ•°
{}

// æœŸæœ›è¡Œä¸º
- è¿”å›"No active terminal found"é”™è¯¯

// å®é™…ç»“æœ
- âœ… æ­£ç¡®å¤„ç†
```

### 5.3 è¾¹ç•Œæ¡ä»¶æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹6: è¶…å¤§å­—ç¬¦æ•°é™åˆ¶
```javascript
// è¾“å…¥å‚æ•°
{ maxChars: 100000 }

// æœŸæœ›è¡Œä¸º
- è‡ªåŠ¨é™åˆ¶ä¸º50000å­—ç¬¦

// å®é™…ç»“æœ
- âœ… æ­£ç¡®é™åˆ¶
```

## 6. çŠ¶æ€ç®¡ç†æµ‹è¯•

### 6.1 å·¥å…·çŠ¶æ€æµè½¬

```
pending â†’ loading â†’ approved/error
```

### 6.2 å‰ç«¯çŠ¶æ€ç®¡ç†

- âœ… `approvalState` æ­£ç¡®å¤„ç†
- âœ… åŠ è½½çŠ¶æ€æ˜¾ç¤º
- âœ… é”™è¯¯çŠ¶æ€æ˜¾ç¤º
- âœ… æˆåŠŸçŠ¶æ€æ˜¾ç¤º

## 7. è¾“å‡ºæ ¼å¼æµ‹è¯•

### 7.1 XMLè¾“å‡ºæ ¼å¼

```xml
<terminal_output>
  <terminal_id>1</terminal_id>
  <terminal_name>Workspace Terminal</terminal_name>
  <shell_type>powershell</shell_type>
  <max_chars>16000</max_chars>
  <output_length>0</output_length>
  <output></output>
</terminal_output>
```

### 7.2 XMLè½¬ä¹‰æµ‹è¯•

- âœ… `&` â†’ `&amp;`
- âœ… `<` â†’ `&lt;`
- âœ… `>` â†’ `&gt;`
- âœ… `"` â†’ `&quot;`
- âœ… `'` â†’ `&apos;`

## 8. æ€§èƒ½æµ‹è¯•

### 8.1 å“åº”æ—¶é—´
- å½“å‰: < 10ms (å› ä¸ºè¿”å›ç©ºè¾“å‡º)
- é¢„æœŸ: < 100ms (åŒ…å«å®é™…è¾“å‡ºå¤„ç†)

### 8.2 å†…å­˜ä½¿ç”¨
- å­—ç¬¦æ•°é™åˆ¶æœºåˆ¶æœ‰æ•ˆé˜²æ­¢å†…å­˜æº¢å‡º
- éœ€è¦æµ‹è¯•å¤§é‡è¾“å‡ºçš„å¤„ç†

## 9. å‘ç°çš„å…³é”®é—®é¢˜æ€»ç»“

### 9.1 åŠŸèƒ½æ€§é—®é¢˜
1. **æ ¸å¿ƒåŠŸèƒ½ç¼ºå¤±**: æ— æ³•è·å–å®é™…ç»ˆç«¯è¾“å‡º
2. **ç¼“å†²åŒºæœªè¿æ¥**: æœªä½¿ç”¨TerminalRegistryçš„è¾“å‡ºç¼“å†²åŒº
3. **å®æ—¶æ•è·ç¼ºå¤±**: æ²¡æœ‰ç›‘å¬ç»ˆç«¯æ•°æ®äº‹ä»¶

### 9.2 é›†æˆé—®é¢˜
1. **ç»ˆç«¯ç®¡ç†å™¨é›†æˆä¸å®Œæ•´**: åªè·å–ç»ˆç«¯ä¿¡æ¯ï¼Œä¸è·å–è¾“å‡º
2. **VS Code APIé™åˆ¶**: æ— æ³•ç›´æ¥è¯»å–ç»ˆç«¯ç¼“å†²åŒº

### 9.3 ç”¨æˆ·ä½“éªŒé—®é¢˜
1. **è¯¯å¯¼æ€§åé¦ˆ**: å·¥å…·æˆåŠŸæ‰§è¡Œä½†è¿”å›ç©ºè¾“å‡º
2. **ä¿¡æ¯ä¸å®Œæ•´**: Shellç±»å‹ç­‰ä¿¡æ¯ç¼ºå¤±

## 10. ä¿®å¤å»ºè®®

### 10.1 ç«‹å³ä¿®å¤é¡¹
1. è¿æ¥TerminalRegistryçš„è¾“å‡ºç¼“å†²åŒº
2. å®ç°å®é™…çš„è¾“å‡ºè·å–é€»è¾‘
3. æ·»åŠ ç»ˆç«¯æ•°æ®ç›‘å¬å™¨

### 10.2 å¢å¼ºåŠŸèƒ½é¡¹
1. å®ç°Shellç±»å‹æ£€æµ‹
2. æ·»åŠ è¾“å‡ºè¿‡æ»¤å’Œæ ¼å¼åŒ–
3. æ”¯æŒå®æ—¶è¾“å‡ºæµ

### 10.3 æ€§èƒ½ä¼˜åŒ–é¡¹
1. å®ç°è¾“å‡ºç¼“å­˜æœºåˆ¶
2. ä¼˜åŒ–å¤§é‡è¾“å‡ºçš„å¤„ç†
3. æ·»åŠ è¾“å‡ºå‹ç¼©é€‰é¡¹

## æµ‹è¯•ç»“è®º

å½“å‰çš„ `get-terminal-output` å·¥å…·åœ¨æ¶æ„è®¾è®¡ä¸Šæ˜¯åˆç†çš„ï¼Œä½†**æ ¸å¿ƒåŠŸèƒ½æœªå®ç°**ã€‚å·¥å…·èƒ½å¤Ÿæ­£ç¡®å¤„ç†å‚æ•°ã€é”™è¯¯æƒ…å†µå’Œè¾“å‡ºæ ¼å¼ï¼Œä½†æ— æ³•è·å–å®é™…çš„ç»ˆç«¯è¾“å‡ºå†…å®¹ï¼Œè¿™ä½¿å¾—å·¥å…·åŸºæœ¬æ— æ³•ä½¿ç”¨ã€‚

éœ€è¦ç«‹å³ä¿®å¤è¾“å‡ºè·å–åŠŸèƒ½ï¼Œå¹¶å®Œå–„ä¸ç»ˆç«¯ç®¡ç†å™¨çš„é›†æˆã€‚
