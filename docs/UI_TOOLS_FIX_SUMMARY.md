# UIå·¥å…·ç•Œé¢ä¿®å¤æ€»ç»“

## æ¦‚è¿°

ä¿®å¤äº†ä¸¤ä¸ªå·¥å…·çš„UIç•Œé¢ç¼ºå¤±é—®é¢˜ï¼š
1. **Context7å·¥å…·** - æ–‡æ¡£è·å–å·¥å…·
2. **ReadImageå·¥å…·** - å›¾ç‰‡è¯»å–å·¥å…·

**æ—¥æœŸ**: 2025-10-08  
**çŠ¶æ€**: âœ… å®Œæˆå¹¶æˆåŠŸæ„å»º

---

## é—®é¢˜è¯Šæ–­

### å‘ç°çš„é—®é¢˜

ä¸¤ä¸ªå·¥å…·è™½ç„¶åœ¨åç«¯æ­£å¸¸å·¥ä½œï¼Œä½†åœ¨å‰ç«¯UIä¸­ä¸æ˜¾ç¤ºï¼š

1. **Context7Tool**
   - âœ… åç«¯å®ç°å®Œæ•´
   - âŒ ç¼ºå°‘UIç»„ä»¶
   - âŒ æœªåœ¨ToolRendererä¸­æ³¨å†Œ

2. **ReadImageTool**
   - âœ… åç«¯å®ç°å®Œæ•´
   - âŒ ç¼ºå°‘UIç»„ä»¶
   - âŒ æœªåœ¨ToolRendererä¸­æ³¨å†Œ

### æ„å»ºé”™è¯¯

```
error TS2741: Property 'context7' is missing in type '...' 
but required in type 'Record<..., Partial<ChatState>>'.
```

**åŸå› **: `use-message-handler.ts` ä¸­çš„ `toolButtonMap` ç¼ºå°‘ `context7` é…ç½®ã€‚

---

## ä¿®å¤å†…å®¹

### 1. Context7å·¥å…·UIä¿®å¤

#### 1.1 åˆ›å»ºUIç»„ä»¶

**æ–‡ä»¶**: `extension/webview-ui-vite/src/components/chat-row/tools/context7-tool.tsx`

```typescript
export const Context7ToolBlock: React.FC<Context7Tool & ToolAddons> = ({
  libraryName,
  topic,
  tokens,
  content,
  approvalState,
  ...
}) => {
  // UIç»„ä»¶å®ç°
};
```

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… å¯æŠ˜å çš„æ–‡æ¡£å†…å®¹æ˜¾ç¤º
- âœ… å¤åˆ¶åˆ°å‰ªè´´æ¿åŠŸèƒ½
- âœ… Markdownæ¸²æŸ“
- âœ… åº“åå’Œä¸»é¢˜ä¿¡æ¯æ˜¾ç¤º
- âœ… åŠ è½½/æˆåŠŸ/é”™è¯¯çŠ¶æ€æ˜¾ç¤º

#### 1.2 æ³¨å†Œåˆ°ToolRenderer

**æ–‡ä»¶**: `extension/webview-ui-vite/src/components/chat-row/chat-tools.tsx`

```typescript
// å¯¼å…¥ç±»å‹
import { Context7Tool } from 'extension/shared/new-tools';

// å¯¼å…¥ç»„ä»¶
import { Context7ToolBlock } from './tools/context7-tool';

// æ³¨å†Œåˆ°ToolRenderer
case 'context7':
  return <Context7ToolBlock {...tool} />;
```

#### 1.3 æ·»åŠ æŒ‰é’®é…ç½®

**æ–‡ä»¶**: `extension/webview-ui-vite/src/hooks/use-message-handler.ts`

```typescript
const toolButtonMap: Record<ChatTool['tool'], Partial<ChatState>> = {
  // ... å…¶ä»–å·¥å…· ...
  context7: {
    ...baseState,
    primaryButtonText: 'Fetch Documentation',
    secondaryButtonText: 'Cancel',
  },
};
```

---

### 2. ReadImageå·¥å…·UIä¿®å¤

#### 2.1 åˆ›å»ºUIç»„ä»¶

**æ–‡ä»¶**: `extension/webview-ui-vite/src/components/chat-row/tools/read-image-tool.tsx`

```typescript
export const ReadImageToolBlock: React.FC<ReadImageTool & ToolAddons> = ({
  path,
  imageData,
  metadata,
  approvalState,
  ...
}) => {
  // UIç»„ä»¶å®ç°
};
```

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… å›¾ç‰‡é¢„è§ˆï¼ˆå¯æŠ˜å ï¼‰
- âœ… å…ƒæ•°æ®æ˜¾ç¤ºï¼ˆå°ºå¯¸ã€å¤§å°ã€æ ¼å¼ï¼‰
- âœ… ä¸‹è½½åŠŸèƒ½
- âœ… å¤åˆ¶è·¯å¾„åŠŸèƒ½
- âœ… æ‰“å¼€æ–‡ä»¶åŠŸèƒ½
- âœ… åŠ è½½/æˆåŠŸ/é”™è¯¯çŠ¶æ€æ˜¾ç¤º

#### 2.2 æ³¨å†Œåˆ°ToolRenderer

**æ–‡ä»¶**: `extension/webview-ui-vite/src/components/chat-row/chat-tools.tsx`

```typescript
// å¯¼å…¥ç±»å‹
import { ReadImageTool } from 'extension/shared/new-tools';

// å¯¼å…¥ç»„ä»¶
import { ReadImageToolBlock } from './tools/read-image-tool';

// æ³¨å†Œåˆ°ToolRenderer
case 'read_image':
  return <ReadImageToolBlock {...tool} />;
```

---

## UIè®¾è®¡

### Context7å·¥å…·UI

#### æŠ˜å çŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“– Context7 Documentation                           â”‚
â”‚ react â†’ hooks (5000 tokens)              [ğŸ“‹] [âœ“]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å±•å¼€çŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“– Context7 Documentation                           â”‚
â”‚ react â†’ hooks (5000 tokens)              [ğŸ“‹] [âœ“]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Library: react                                      â”‚
â”‚ Topic: hooks                                        â”‚
â”‚ Max Tokens: 5000                                    â”‚
â”‚                                                     â”‚
â”‚ [View Documentation â–¼]                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ # React Hooks                                â”‚   â”‚
â”‚ â”‚ Hooks are functions that let you...         â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â”‚ âœ“ Documentation fetched successfully.              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ReadImageå·¥å…·UI

#### æŠ˜å çŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ–¼ï¸ Read Image                                        â”‚
â”‚ logo.png â€¢ 512Ã—512 â€¢ 45.2 KB         [ğŸ“‹] [â¬‡ï¸] [âœ“] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å±•å¼€çŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ–¼ï¸ Read Image                                        â”‚
â”‚ logo.png â€¢ 512Ã—512 â€¢ 45.2 KB         [ğŸ“‹] [â¬‡ï¸] [âœ“] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ File: /path/to/logo.png [Open]                      â”‚
â”‚ Dimensions: 512 Ã— 512                               â”‚
â”‚ Size: 45.2 KB                                       â”‚
â”‚ Format: PNG                                         â”‚
â”‚                                                     â”‚
â”‚ [View Image â–¼]                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚                                              â”‚   â”‚
â”‚ â”‚         [Image Preview]                      â”‚   â”‚
â”‚ â”‚                                              â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â”‚ âœ“ Image read successfully.                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

1. **`extension/webview-ui-vite/src/components/chat-row/tools/context7-tool.tsx`**
   - Context7å·¥å…·UIç»„ä»¶
   - 155è¡Œä»£ç 

2. **`extension/webview-ui-vite/src/components/chat-row/tools/read-image-tool.tsx`**
   - ReadImageå·¥å…·UIç»„ä»¶
   - 200è¡Œä»£ç 

3. **`docs/CONTEXT7_UI_FIX.md`**
   - Context7 UIä¿®å¤è¯¦ç»†æ–‡æ¡£

4. **`docs/UI_TOOLS_FIX_SUMMARY.md`**
   - æœ¬æ–‡æ¡£

### ä¿®æ”¹æ–‡ä»¶

1. **`extension/webview-ui-vite/src/components/chat-row/chat-tools.tsx`**
   - å¯¼å…¥Context7Toolå’ŒReadImageToolç±»å‹
   - å¯¼å…¥Context7ToolBlockå’ŒReadImageToolBlockç»„ä»¶
   - åœ¨ToolRendererä¸­æ·»åŠ ä¸¤ä¸ªcase

2. **`extension/webview-ui-vite/src/hooks/use-message-handler.ts`**
   - åœ¨toolButtonMapä¸­æ·»åŠ context7é…ç½®

---

## æ„å»ºç»“æœ

### æ„å»ºå‘½ä»¤
```bash
cd extension && pnpm run build
```

### æ„å»ºçŠ¶æ€
âœ… **æˆåŠŸ**

### æ„å»ºè¾“å‡º
```
âœ“ 6846 modules transformed.
âœ“ built in 15.23s
âœ“ check-types passed
âœ“ lint passed (1 warning)
âœ“ Packaged: vlinder-3.7.21.vsix (395 files, 35.55 MB)
```

### è­¦å‘Šä¿¡æ¯
- 1ä¸ªESLintè­¦å‘Šï¼ˆæœªä½¿ç”¨çš„eslint-disableæŒ‡ä»¤ï¼‰
- å»ºè®®ä½¿ç”¨bundleä¼˜åŒ–ï¼ˆæ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼‰

---

## åŠŸèƒ½éªŒè¯

### Context7å·¥å…·

**æµ‹è¯•æ­¥éª¤**:
1. å¯åŠ¨VSCodeæ‰©å±•è°ƒè¯•ï¼ˆF5ï¼‰
2. æ‰“å¼€Vlinderä¾§è¾¹æ 
3. è¾“å…¥: "æŸ¥çœ‹React hooksæ–‡æ¡£"
4. Agentè°ƒç”¨context7å·¥å…·

**é¢„æœŸç»“æœ**:
- âœ… å·¥å…·å¡ç‰‡æ­£å¸¸æ˜¾ç¤º
- âœ… æ ‡é¢˜æ˜¾ç¤º "Context7 Documentation"
- âœ… æ‘˜è¦æ˜¾ç¤ºåº“åå’Œä¸»é¢˜
- âœ… å¯ä»¥å±•å¼€/æŠ˜å 
- âœ… æ–‡æ¡£å†…å®¹æ­£ç¡®æ¸²æŸ“
- âœ… å¤åˆ¶æŒ‰é’®å·¥ä½œæ­£å¸¸

---

### ReadImageå·¥å…·

**æµ‹è¯•æ­¥éª¤**:
1. å¯åŠ¨VSCodeæ‰©å±•è°ƒè¯•ï¼ˆF5ï¼‰
2. æ‰“å¼€Vlinderä¾§è¾¹æ 
3. è¾“å…¥: "è¯»å–é¡¹ç›®ä¸­çš„logo.pngå›¾ç‰‡"
4. Agentè°ƒç”¨read_imageå·¥å…·

**é¢„æœŸç»“æœ**:
- âœ… å·¥å…·å¡ç‰‡æ­£å¸¸æ˜¾ç¤º
- âœ… æ ‡é¢˜æ˜¾ç¤º "Read Image"
- âœ… æ‘˜è¦æ˜¾ç¤ºæ–‡ä»¶åã€å°ºå¯¸ã€å¤§å°
- âœ… å¯ä»¥å±•å¼€/æŠ˜å 
- âœ… å›¾ç‰‡é¢„è§ˆæ­£å¸¸æ˜¾ç¤º
- âœ… å…ƒæ•°æ®æ­£ç¡®æ˜¾ç¤º
- âœ… ä¸‹è½½æŒ‰é’®å·¥ä½œæ­£å¸¸
- âœ… å¤åˆ¶è·¯å¾„æŒ‰é’®å·¥ä½œæ­£å¸¸
- âœ… æ‰“å¼€æ–‡ä»¶æŒ‰é’®å·¥ä½œæ­£å¸¸

---

## æŠ€æœ¯ç»†èŠ‚

### ç»„ä»¶è®¾è®¡åŸåˆ™

1. **ä¸€è‡´æ€§** - éµå¾ªé¡¹ç›®ä¸­å…¶ä»–å·¥å…·çš„è®¾è®¡æ¨¡å¼
2. **å¯æŠ˜å ** - é»˜è®¤æŠ˜å ï¼ŒèŠ‚çœç©ºé—´
3. **ä¿¡æ¯ä¸°å¯Œ** - æ‘˜è¦æ˜¾ç¤ºå…³é”®ä¿¡æ¯
4. **äº¤äº’å‹å¥½** - æä¾›å¤åˆ¶ã€ä¸‹è½½ç­‰ä¾¿æ·åŠŸèƒ½
5. **çŠ¶æ€æ¸…æ™°** - æ˜ç¡®æ˜¾ç¤ºåŠ è½½ã€æˆåŠŸã€é”™è¯¯çŠ¶æ€

### çŠ¶æ€ç®¡ç†

```typescript
approvalState: 'pending' | 'loading' | 'approved' | 'error' | 'rejected'
```

**çŠ¶æ€æµè½¬**:
```
pending â†’ loading â†’ approved/error
```

### å›¾æ ‡é€‰æ‹©

- **Context7**: `BookOpen` - è¡¨ç¤ºæ–‡æ¡£
- **ReadImage**: `Image` - è¡¨ç¤ºå›¾ç‰‡

---

## ç›¸å…³æ–‡æ¡£

- `docs/CONTEXT7_UI_FIX.md` - Context7 UIä¿®å¤è¯¦ç»†æ–‡æ¡£
- `docs/CONTEXT7_AGENT_OPTIMIZATION.md` - Agentä¼˜åŒ–è®¾è®¡
- `docs/CONTEXT7_MERGE_SUMMARY.md` - æ–‡ä»¶åˆå¹¶æ€»ç»“
- `docs/CONTEXT7_SELF_HOSTED_IMPLEMENTATION.md` - è‡ªæ‰˜ç®¡å®ç°
- `docs/CONTEXT7_SELF_HOSTED_USAGE.md` - ä½¿ç”¨æŒ‡å—

---

## æ€»ç»“

### ä¿®å¤æˆæœ

- âœ… Context7å·¥å…·UIå®Œæ•´å®ç°
- âœ… ReadImageå·¥å…·UIå®Œæ•´å®ç°
- âœ… æ„å»ºæˆåŠŸæ— é”™è¯¯
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### ä»£ç è´¨é‡

- âœ… TypeScriptç±»å‹å®‰å…¨
- âœ… éµå¾ªé¡¹ç›®ä»£ç è§„èŒƒ
- âœ… ç»„ä»¶è®¾è®¡ä¸€è‡´
- âœ… ç”¨æˆ·ä½“éªŒè‰¯å¥½

### ä¸‹ä¸€æ­¥

1. **æµ‹è¯•éªŒè¯** - åœ¨VSCodeä¸­æµ‹è¯•ä¸¤ä¸ªå·¥å…·çš„UI
2. **ç”¨æˆ·åé¦ˆ** - æ”¶é›†ç”¨æˆ·ä½¿ç”¨åé¦ˆ
3. **æ€§èƒ½ä¼˜åŒ–** - è€ƒè™‘bundleä¼˜åŒ–å»ºè®®
4. **æ–‡æ¡£å®Œå–„** - æ›´æ–°ç”¨æˆ·ä½¿ç”¨æ–‡æ¡£

---

**ä¿®å¤å®Œæˆï¼** ä¸¤ä¸ªå·¥å…·ç°åœ¨éƒ½æ‹¥æœ‰å®Œæ•´çš„UIç•Œé¢æ”¯æŒï¼ğŸ‰

